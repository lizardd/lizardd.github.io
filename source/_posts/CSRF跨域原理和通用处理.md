---
title: CSRF跨域原理和通用处理
date: 2019-03-31 15:34:22
tags: WEB CSRF
---


## CSRF 跨站点请求伪造，和XSS攻击一样，对于网站存在巨大的危害，攻击者以你的名义在你不知情的情况下发送了恶意请求到访问的网站。


#### 攻击原理和过程
 1. 用户打开浏览器并登录访问了A网站。（A网站存在CSRF攻击漏洞）
 2. 在用户没有关闭A网站的同时，访问了B网站，B网站返回了一串恶意代码
 3. 【会自动请求A网站的某些功能，并带上A网站的合法Cookie信息】。
 4. 在用户不知情的情况下，B网站返回的恶意代码被被执行了，向A网站发送了请求。
 5. A网站后端得到“非法请求”之后，验证Cookie信息确是合法的，则合法处理该请求。导致恶意请求被执行。

#### CSRF漏洞检测
以CSRFTester工具为例，CSRF漏洞检测工具的测试原理如下：使用CSRFTester进行测试时，首先需要抓取我们在浏览器中访问过的所有链接以及所有的表单等信息，然后通过在CSRFTester中修改相应的表单等信息，重新提交，这相当于一次伪造客户端请求。如果修改后的测试请求成功被网站服务器接受，则说明存在CSRF漏洞，当然此款工具也可以被用来进行CSRF攻击

#### CSRF通用处理方案
##### 一般防御CSRF攻击主要有三种方案：
* 验证请求头HTTP Referer字段
* 使用CSRFToken提交参数并验证
* 在HTTP请求头中自定义属性并验证
